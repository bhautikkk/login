<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flappy Cube</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        canvas {
            border: 4px solid #fff;
            background-color: #70c5ce; /* Sky Blue background */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: block;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="320" height="480"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Game Variables
    let frames = 0;
    const DEGREE = Math.PI / 180;

    // Game State
    const state = {
        current: 0,
        getReady: 0,
        game: 1,
        over: 2
    };

    // Controls
    document.addEventListener("click", function(evt) {
        switch(state.current) {
            case state.getReady:
                state.current = state.game;
                break;
            case state.game:
                bird.flap();
                break;
            case state.over:
                resetGame();
                break;
        }
    });

    document.addEventListener("keydown", function(evt) {
        if (evt.code === "Space") {
            switch(state.current) {
                case state.getReady:
                    state.current = state.game;
                    break;
                case state.game:
                    bird.flap();
                    break;
                case state.over:
                    resetGame();
                    break;
            }
        }
    });

    // The Bird Object
    const bird = {
        x: 50,
        y: 150,
        w: 25,
        h: 25,
        radius: 12,
        speed: 0,
        gravity: 0.25,
        jump: 4.6,
        
        draw: function() {
            ctx.fillStyle = "#FFD700"; // Gold Color
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); 
            ctx.fill();
            ctx.stroke();
            
            // Eye
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            ctx.arc(this.x + 5, this.y - 5, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
        },
        
        update: function() {
            // Physics
            if (state.current == state.getReady) {
                this.y = 150; // Reset position
            } else {
                this.speed += this.gravity;
                this.y += this.speed;
                
                // Floor Collision
                if (this.y + this.radius >= canvas.height - fg.h) {
                    this.y = canvas.height - fg.h - this.radius;
                    state.current = state.over;
                }
            }
        },
        
        flap: function() {
            this.speed = -this.jump;
        }
    };

    // Background
    const bg = {
        draw: function() {
            ctx.fillStyle = "#70c5ce";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Clouds (simple circles)
            ctx.fillStyle = "#fff";
            ctx.beginPath(); ctx.arc(100, 300, 30, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(140, 310, 40, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(250, 100, 30, 0, Math.PI*2); ctx.fill();
        }
    };

    // Foreground (Ground)
    const fg = {
        h: 80, 
        x: 0,
        dx: 2,
        draw: function() {
            ctx.fillStyle = "#ded895";
            ctx.fillRect(0, canvas.height - this.h, canvas.width, this.h);
            
            // Grass line
            ctx.fillStyle = "#73bf2e";
            ctx.fillRect(0, canvas.height - this.h, canvas.width, 15);
        },
        update: function() {
            if (state.current == state.game) {
                this.x = (this.x - this.dx) % (canvas.width/2);
            }
        }
    };

    // Pipes
    const pipes = {
        position: [],
        w: 53,
        h: 400,
        gap: 100, // Space between pipes
        dx: 2,
        
        draw: function() {
            for (let i = 0; i < this.position.length; i++) {
                let p = this.position[i];
                let topY = p.y;
                let bottomY = p.y + this.h + this.gap;
                
                // Pipe Color
                ctx.fillStyle = "#73bf2e";
                ctx.strokeStyle = "#000";
                
                // Top Pipe
                ctx.fillRect(p.x, topY, this.w, this.h);
                ctx.strokeRect(p.x, topY, this.w, this.h);
                
                // Bottom Pipe
                ctx.fillRect(p.x, bottomY, this.w, this.h);
                ctx.strokeRect(p.x, bottomY, this.w, this.h);
            }
        },
        
        update: function() {
            if (state.current !== state.game) return;
            
            // Add new pipe every 100 frames
            if (frames % 100 == 0) {
                this.position.push({
                    x: canvas.width,
                    y: -150 * (Math.random() + 1)
                });
            }
            
            for (let i = 0; i < this.position.length; i++) {
                let p = this.position[i];
                p.x -= this.dx;

                // Collision Detection Logic
                let bottomPipeY = p.y + this.h + this.gap;
                
                // Check if bird hits pipe
                if (
                    bird.x + bird.radius > p.x && 
                    bird.x - bird.radius < p.x + this.w && 
                    (bird.y - bird.radius < p.y + this.h || bird.y + bird.radius > bottomPipeY)
                ) {
                    state.current = state.over;
                }

                // Remove pipes that go off screen
                if (p.x + this.w <= 0) {
                    this.position.shift();
                    score.value += 1; // Increase Score
                }
            }
        }
    };

    // Score
    const score = {
        best: 0, // Not saving to local storage in this simple version
        value: 0,
        
        draw: function() {
            ctx.fillStyle = "#FFF";
            ctx.strokeStyle = "#000";
            
            if (state.current == state.game) {
                ctx.lineWidth = 2;
                ctx.font = "35px Impact";
                ctx.fillText(this.value, canvas.width / 2, 50);
                ctx.strokeText(this.value, canvas.width / 2, 50);
            } else if (state.current == state.over) {
                // Game Over Score
                ctx.font = "25px Impact";
                ctx.fillText("Score: " + this.value, canvas.width / 2 - 40, 180);
                ctx.strokeText("Score: " + this.value, canvas.width / 2 - 40, 180);
                
                ctx.font = "40px Impact";
                ctx.fillText("GAME OVER", 60, 250);
                ctx.strokeText("GAME OVER", 60, 250);

                ctx.font = "20px Arial";
                ctx.fillStyle = "#000";
                ctx.fillText("Click to Restart", 90, 300);
            } else if (state.current == state.getReady) {
                ctx.fillStyle = "#000";
                ctx.font = "20px Arial";
                ctx.fillText("Click or Space to Start", 60, 240);
            }
        }
    };

    function resetGame() {
        bird.speed = 0;
        pipes.position = [];
        score.value = 0;
        frames = 0;
        state.current = state.getReady;
    }

    function draw() {
        bg.draw();
        pipes.draw();
        fg.draw();
        bird.draw();
        score.draw();
    }

    function update() {
        bird.update();
        fg.update();
        pipes.update();
    }

    function loop() {
        update();
        draw();
        frames++;
        requestAnimationFrame(loop);
    }

    loop();

</script>
</body>
</html>